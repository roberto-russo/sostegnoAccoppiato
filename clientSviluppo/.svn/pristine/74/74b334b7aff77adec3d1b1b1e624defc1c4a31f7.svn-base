package it.csi.zoo;


import it.csi.srmanags.wsbridge2.Response;
import it.csi.srmanags.wsbridge2.WSBridge2;
import it.csi.srmanags.wsbridge2.WSBridgeInternalException_Exception;
import it.csi.srmanags.wsbridge2.WSBridgeService;
import it.csi.zoo.model.Rpu_V_pratica_zoote;
import it.csi.zoo.services.AziendaService;
import it.csi.zoo.services.http.BdnHttpServices;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.io.IOException;
import java.util.List;


@RestController
public class WebServiceController {

    @Autowired
    private AziendaService aziendaService;

    //se invocato con chiamata POST restituisce in console il token d'accesso
    @RequestMapping("/bdn")
    public void bdn() throws IOException {
        BdnHttpServices bdnHttpServices = new BdnHttpServices();
        bdnHttpServices.httpClientPost();
    }

    @GetMapping(value = "/calcoloArt52")
    public String proceduraCuua() {
        WSBridge2 wsBridge2 = new WSBridgeService().getWSBridge2Port();
        List<Rpu_V_pratica_zoote> list = aziendaService.getAll();
        try {  
       		 Response response = wsBridge2.getElencoCapiPremioNew("310","BBBCRL75R13L219U",2019);
       		 System.out.println(" CODICE ERRORE:  " + response.getCodiceErrore());
       		 System.out.println("DESCRIZIONE ERRORE: " + response.getDescrizioneErrore());
       		 System.out.println("ESITO DOMANDA: " + response.getVEsitoDomanda());
       		 System.out.println("GET TIPO OUTPUT: " + response.getTipoOutput());
       		 System.out.println("ESITO: " + response.getEsito());
       		 System.out.println("INFO: " + response.getInfo());
       		 System.out.println("MESSAGGIODI RITORNO: " + response.getMsgRet());
       		 System.out.println("CODICE RITORNO: " + response.getCodRet());
       		 System.out.println("GET WARNING: " + response.getWarning());
        } catch (WSBridgeInternalException_Exception e) {
            e.printStackTrace();
        }

        return "Procedura avviata";
    }

    /* PROVA CHIAMATA AL DATABASE ORACLE */

    @GetMapping(value = "/chiamataDb")
    public String chiamataDb() {

        List<Rpu_V_pratica_zoote> list = aziendaService.getAll();

        System.out.println(list.size());

        System.out.println("--- STAMPO INFORMAZIONI ---");
        for (Rpu_V_pratica_zoote x : list)
            System.out.println(x.toString());

        if (list.isEmpty())
            return "KO";
        else
            return "OK";
    }
    @GetMapping(value = "/proceduraCuua")
    public String proceduraCuua2() {
        WSBridge2 wsBridge2 = new WSBridgeService().getWSBridge2Port();
        try {
        	Response response = wsBridge2.getElencoCapiPremioNew("312","BBBCRL75R13L219U",2016);
            System.out.println(" CODICE ERRORE:  " + response.getCodiceErrore());
      		 System.out.println("DESCRIZIONE ERRORE: " + response.getDescrizioneErrore());
      		 System.out.println("ESITO DOMANDA: " + response.getVEsitoDomanda());
      		 System.out.println("GET TIPO OUTPUT: " + response.getTipoOutput());
      		 System.out.println("ESITO: " + response.getEsito());
      		 System.out.println("INFO: " + response.getInfo());
      		 System.out.println("MESSAGGIODI RITORNO: " + response.getMsgRet());
      		 System.out.println("CODICE RITORNO: " + response.getCodRet());
      		 System.out.println("GET WARNING: " + response.getWarning());
        } catch (WSBridgeInternalException_Exception e) {
            e.printStackTrace();
        }

        return "Procedura avviata";
    }
}