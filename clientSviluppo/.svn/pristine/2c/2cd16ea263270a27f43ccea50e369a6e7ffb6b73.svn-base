package it.csi.demetra.demetraws.zoo.controlli.visitor;

import it.csi.demetra.demetraws.srmanags.wsbridge2.WSBridgeInternalException_Exception;
import it.csi.demetra.demetraws.zoo.controlli.visitor.entityRef.Controllo;
import it.csi.demetra.demetraws.zoo.model.Dmt_s_controllo_bean;
import it.csi.demetra.demetraws.zoo.model.Dmt_s_sessione;
import it.csi.demetra.demetraws.zoo.model.Rpu_V_pratica_zoote;
import it.csi.demetra.demetraws.zoo.services.ControlliService;
import org.springframework.context.ApplicationContext;

import java.text.ParseException;
import java.util.Optional;

public class EntityFactory {

    public EntityFactory() {
    }

    public Controllo getControllo(Rpu_V_pratica_zoote azienda, Dmt_s_sessione sessione, ControlliService controlliService, ApplicationContext ctx) throws ControlloException, ParseException, WSBridgeInternalException_Exception {
        Optional<Dmt_s_controllo_bean> c = controlliService.findByIdControlloBean(azienda.getCodicePremio());
        Controllo res = null;
        if (c.isPresent())
            res = (Controllo) ctx.getBean(c.get().getBean());
        else throw new ControlloException("Bean corrispondente non trovato");

        res.setSessione(sessione);
        res.setControlliService(controlliService);
        res.setAzienda(azienda);

        return res;
    }

}
